<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script>

$(document).ready(function(){
  $("#run-button").click(() => {
  
	const solutionLogElement = $('#solution-log');
	
	solutionLogElement.text('');
	$('#analysis').text('');
	
	//$('#note-text').html('<b>Scroll all the way down to view the whole solution.</b>');
	
    runSolution( logText => solutionLogElement.append(`${logText} <br><br>`) );
	
	console.log(log);
  });
  $("#run-many-times-button").click(() => {
  
	for (let i = 0; i<1000; i++){
		runSolution();
	}
	
	const wonGames = log.filter(game => game.victory).map(game => game.victory).length;
	$('#solution-log').html(`games: ${log.length}, won: ${wonGames}, ${(wonGames/log.length)*100}%`);
	
	console.log(log);
  });
});

class Word {
	constructor(pronunciation, meaning) {
		this.pronunciation = pronunciation;
		this.meaning = meaning === true;
	}
	
	getPronunciation() {
		return this.pronunciation;
	}
	
	getMeaning() {
		return this.meaning;
	}
}

class Idol{
	constructor(id, name) {
		this.id = id;
		this.name = name;
	}
	
	getId(){
		return this.id;
	}
	
	getName(){
		return this.name;
	}
}

class Overlord {
	constructor(id, name, trueWord, falseWord) {
		this.id = id;
		this.name = name;
		this.trueWord = trueWord;
		this.falseWord = falseWord;
	}
	
	giveIdol(idol){
		this.idol = idol;
		this.pleased = this.idol.getId() === this.id;
	}

	getId(){
		return this.id;
	}

	getName(){
		return this.name;
	}

	getTrueAnswer (){
		return this.trueWord;
	}

	getFalseAnswer (){
		return this.falseWord;
	}

	getAnswer(id, {wordReference1, wordReference2}) {
		throw new Exception('Not supported');

	}
	
	getOpinion(){
		if (this.idol == null){
			return 'Give me an idol, you fool. I am displeased!';
		}
		
		return `I am ${this.name}. You gave me the ${this.idol.name}. I am ${this.pleased ? 'pleased': 'displeased'}!`;
	}
	
	isPleased(){
		return this.pleased == true;
	}
}

class TruthfulOverlord extends Overlord {
	constructor(id, name, trueWord, falseWord) {
		super(id, name, trueWord, falseWord);
	}

	getAnswer(id, references) {
		const {wordReference1, wordReference2, overlordReference } = references || {};
		
		if (id == obviousQuestion.id){
			return this.getFalseAnswer();
			
		} else if (id == referenceQuestion.id){
		
			if (wordReference1.getMeaning() == true) {
				return this.getTrueAnswer();
			} else if (wordReference1.getMeaning() == false){
				return this.getFalseAnswer();
			}
		} else if (id == answerComparisonQuestion.id) {
			if (wordReference1.getMeaning() == true && wordReference2.getMeaning() === true) {
				return this.getTrueAnswer();
			}
			return this.getFalseAnswer();
		} else if (id == randomOverlordIdentityQuestion.id) {
			if (overlordReference instanceof RandomOverlord) {
				return this.getTrueAnswer();
			}
			return this.getFalseAnswer();
		}
		
		return new Word('Hmm?', undefined); //If this answer is reached, something is wrong with my code.
	}
}

class LyingOverlord extends Overlord {
	constructor(id, name, trueWord, falseWord) {
		super(id, name, trueWord, falseWord);
	}

	getAnswer(id, references) {
		const {wordReference1, wordReference2, overlordReference } = references || {};
		
		if (id == obviousQuestion.id){
			return this.getFalseAnswer();
			
		} else if (id == referenceQuestion.id){

			if (wordReference1.getMeaning() == true) {
				return this.getFalseAnswer();
			} else if (wordReference1.getMeaning() == false){
				return this.getTrueAnswer();
			}
		} else if (id == answerComparisonQuestion.id) {
			if (wordReference1.getMeaning() == true && wordReference2.getMeaning() === true) {
				return this.getFalseAnswer();
			}
			return this.getTrueAnswer();
		} else if (id == randomOverlordIdentityQuestion.id) {
			if (overlordReference instanceof RandomOverlord) {
				return this.getTrueAnswer();
			}
			return this.getFalseAnswer();
		}
		return new Word('Hmm?', undefined);
	}
}

class RandomOverlord extends Overlord {
	constructor(id, name, trueWord, falseWord) {
		super(id, name, trueWord, falseWord);
	}

	getAnswer() {
		const randomizer = getRandomInt(2);
		return randomizer == 0 ? this.getTrueAnswer() : this.getFalseAnswer();
	}
}

function getRandomInt(max) {
  return Math.floor(Math.random() * Math.floor(max));
}

const obviousQuestion = {
	id: 0,
	question: 'Is the sky blue?',
	description: 'An obvious question that you know the answer to.'
}

const referenceQuestion = {
	id: 1,
	question: 'Was the answer to the first question a yes?',
	description: "Ask an overlord information on another's answer."
}

const answerComparisonQuestion = {
	id: 2,
	question: 'Were the last two answers a yes?',
	description: 'Asks the overlord to compare two answers'
}


const randomOverlordIdentityQuestion = {
	id:3,
	question: 'Is that the overlord who answers randomly?',
	description: 'Used to determine the identity of the randomly answering one.'
}

const log = [];

let gameId = 0;

const runSolution = (printFunction = ()=>{}) => {

	printFunction('Starting program..');

	const t0 = performance.now();

	const wordPronunciations = shuffle(['Ozo', 'Ulu']);
	
	const wordForTrue = new Word(wordPronunciations[0], true);
	const wordForfalse = new Word(wordPronunciations[1], false);
	
	const overlords = shuffle([new TruthfulOverlord(0, 'Tee', wordForTrue, wordForfalse), 
		new LyingOverlord(1, 'Eff', wordForTrue, wordForfalse),
		new RandomOverlord(2, 'Arr', wordForTrue, wordForfalse)]);
		
	const idolOfTee = new Idol(0, 'Idol of Tee');
	const idolOfEff = new Idol(1, 'Idol of Eff');
	const idolOfArr = new Idol(2, 'Idol of Arr');
	
	const [overlord1, overlord2, overlord3] = overlords;
	
	const questionsAndAnswers = [];

	const gameLog = {
		id: gameId,
		questionsAndAnswers,
		overlords,
		wordForTrue,
		wordForfalse
	}
		
	getSolution2([overlord1, overlord2, overlord3], {idolOfTee, idolOfEff, idolOfArr}, questionsAndAnswers, printFunction);
	
	printFunction(overlord1.getOpinion());
	printFunction(overlord2.getOpinion());
	printFunction(overlord3.getOpinion());
	
	gameLog.victory = overlord1.isPleased() && overlord2.isPleased() && overlord3.isPleased();
	
	log.push(gameLog);
	
	gameId++;
	
	const t1 = performance.now();

	printFunction(`The program took ${t1 - t0} milliseconds to run.<br>`);

	printFunction('Program finished.');
}

const getSolution2 = ([overlord1, overlord2, overlord3], {idolOfTee, idolOfEff, idolOfArr}, questionsAndAnswers, printFunction) => {
	printFunction(obviousQuestion.question);
	
	const anwerOfLord1Question1 = overlord1.getAnswer(obviousQuestion.id, null);
	printFunction(`Overlord 1: ${anwerOfLord1Question1.getPronunciation()}`);


	
	questionsAndAnswers.push({
		question: obviousQuestion,
		orderNumber: 0,
		addressedTo:0,
		answer: anwerOfLord1Question1.getPronunciation()
	});

	printFunction(referenceQuestion.question);
	const anwerOfLord2Question2 = overlord2.getAnswer(referenceQuestion.id, {wordReference1: anwerOfLord1Question1});
	printFunction(`Overlord 2: ${anwerOfLord2Question2.getPronunciation()}`);

	questionsAndAnswers.push({
		question: referenceQuestion,
		orderNumber: 1,
		addressedTo: 1,
		answer: anwerOfLord2Question2.getPronunciation()
	});
	
	printFunction(randomOverlordIdentityQuestion.question);
	
	const references = {overlordReference: overlord1};
	
	const answerOfLord1Question3 = overlord1.getAnswer(randomOverlordIdentityQuestion.id, references)
	printFunction(`Overlord 1: ${answerOfLord1Question3.getPronunciation()}`);
	
	const answerOfLord2Question3 = overlord2.getAnswer(randomOverlordIdentityQuestion.id, references)
	printFunction(`Overlord 2: ${answerOfLord2Question3.getPronunciation()}`);
	
	const answerOfLord3Question3 = overlord3.getAnswer(randomOverlordIdentityQuestion.id, references)
	printFunction(`Overlord 3: ${answerOfLord3Question3.getPronunciation()}`);
	
	questionsAndAnswers.push({
		question: answerComparisonQuestion,
		orderNumber: 2,
		addressedTo: 0,
		answer: answerOfLord1Question3.getPronunciation()
	},
	{
		question: answerComparisonQuestion,
		orderNumber: 2,
		addressedTo:1,
		answer: answerOfLord2Question3.getPronunciation()
	},
	{
		question: answerComparisonQuestion,
		orderNumber: 2,
		addressedTo:2,
		answer: answerOfLord3Question3.getPronunciation()
	});
		/**
	<li>Tee, Eff, Arr</li>
	<li>Tee, Arr, Eff</li>
	<li>Eff, Tee, Arr</li>
	<li>Eff, Arr, Tee</li>
	<li>Arr, Tee, Eff</li>
	<li>Arr, Eff, Tee</li>
		*/
	if (anwerOfLord1Question1.getPronunciation() == anwerOfLord2Question2.getPronunciation()){
		//If the  first and second answers are the same
		
		if (anwerOfLord1Question1.getPronunciation()=='Ozo'){
			if (anwerOfLord2Question2.getPronunciation() == answerOfLord3Question3.getPronunciation()){
				overlord1.giveIdol(idolOfTee);
				overlord2.giveIdol(idolOfEff);
				overlord3.giveIdol(idolOfArr);
			} else { //If the second and third answers are not the same
				overlord1.giveIdol(idolOfTee);
				overlord2.giveIdol(idolOfArr);
				overlord3.giveIdol(idolOfEff);
			}
		} else {
		
			if (anwerOfLord2Question2.getPronunciation() == answerOfLord3Question3.getPronunciation()){
				overlord1.giveIdol(idolOfEff);
				overlord2.giveIdol(idolOfTee);
				overlord3.giveIdol(idolOfArr);
			} else { //If the second and third answers are not the same
				overlord1.giveIdol(idolOfEff);
				overlord2.giveIdol(idolOfArr);
				overlord3.giveIdol(idolOfTee);
			}
		}
		
		
	} else if (anwerOfLord1Question1.getPronunciation() != anwerOfLord2Question2.getPronunciation()){ //If the first and second answers are not the same
			
				
		if (anwerOfLord1Question1.getPronunciation()=='Ozo'){
			if (anwerOfLord2Question2.getPronunciation() == answerOfLord3Question3.getPronunciation()){
				overlord1.giveIdol(idolOfArr);
				overlord2.giveIdol(idolOfTee);
				overlord3.giveIdol(idolOfEff);
			} else { //If the second and third answers are not the same
				overlord1.giveIdol(idolOfArr);
				overlord2.giveIdol(idolOfEff);
				overlord3.giveIdol(idolOfTee);
			}
		} else {
		
			if (anwerOfLord2Question2.getPronunciation() == answerOfLord3Question3.getPronunciation()){
				overlord1.giveIdol(idolOfEff);
				overlord2.giveIdol(idolOfTee);
				overlord3.giveIdol(idolOfArr);
			} else { //If the second and third answers are not the same
				overlord1.giveIdol(idolOfEff);
				overlord2.giveIdol(idolOfArr);
				overlord3.giveIdol(idolOfTee);
			}
		}
	}
};

const presentIdols = ([overlord1, overlord2, overlord3]) => {
	
}

const getSolution1 = ([overlord1, overlord2, overlord3], {idolOfTee, idolOfEff, idolOfArr}, questionsAndAnswers, printFunction) =>{
	printFunction(obviousQuestion.question);
	
	const anwerOfLord1Question1 = overlord1.getAnswer(obviousQuestion.id, null);
	printFunction(`Overlord 1: ${anwerOfLord1Question1.getPronunciation()}`);


	
	questionsAndAnswers.push({
		question: obviousQuestion,
		orderNumber: 0,
		addressedTo:0,
		answer: anwerOfLord1Question1.getPronunciation()
	});

	printFunction(referenceQuestion.question);
	const anwerOfLord2Question2 = overlord2.getAnswer(referenceQuestion.id, {wordReference1: anwerOfLord1Question1});
	printFunction(`Overlord 2: ${anwerOfLord2Question2.getPronunciation()}`);

	questionsAndAnswers.push({
		question: referenceQuestion,
		orderNumber: 1,
		addressedTo: 1,
		answer: anwerOfLord2Question2.getPronunciation()
	});
	
	printFunction(answerComparisonQuestion.question);
	
	const references = {wordReference1: anwerOfLord1Question1, wordReference2:anwerOfLord2Question2};
	
	const answerOfLord1Question3 = overlord1.getAnswer(answerComparisonQuestion.id, references)
	printFunction(`Overlord 1: ${answerOfLord1Question3.getPronunciation()}`);
	
	const answerOfLord2Question3 = overlord2.getAnswer(answerComparisonQuestion.id, references)
	printFunction(`Overlord 2: ${answerOfLord2Question3.getPronunciation()}`);
	
	const answerOfLord3Question3 = overlord3.getAnswer(answerComparisonQuestion.id, references)
	printFunction(`Overlord 3: ${answerOfLord3Question3.getPronunciation()}`);
	
	questionsAndAnswers.push({
		question: answerComparisonQuestion,
		orderNumber: 2,
		addressedTo: 0,
		answer: answerOfLord1Question3.getPronunciation()
	},
	{
		question: answerComparisonQuestion,
		orderNumber: 2,
		addressedTo:1,
		answer: answerOfLord2Question3.getPronunciation()
	},
	{
		question: answerComparisonQuestion,
		orderNumber: 2,
		addressedTo:2,
		answer: answerOfLord3Question3.getPronunciation()
	});

	//runOneThirdSolution({anwerOfLord1Question1, anwerOfLord2Question2}, {overlord1, overlord2, overlord3}, {idolOfTee, idolOfEff, idolOfArr});
	/*
	runFortyPercentSolution(
		{anwerOfLord1Question1, anwerOfLord2Question2, answerOfLord3Question3}, 
		{overlord1, overlord2, overlord3}, 
		{idolOfTee, idolOfEff, idolOfArr}
	);*/
	
		
	if (anwerOfLord1Question1.getPronunciation() == anwerOfLord2Question2.getPronunciation()){
		//If the  first and second answers are the same
		
		if (anwerOfLord2Question2.getPronunciation() == answerOfLord3Question3.getPronunciation()){
			overlord1.giveIdol(idolOfEff);
			overlord2.giveIdol(idolOfTee);
			overlord3.giveIdol(idolOfArr);
		} else if (anwerOfLord2Question2.getPronunciation() != answerOfLord3Question3.getPronunciation()) { //If the second and third answers are not the same
			overlord1.giveIdol(idolOfArr);
			overlord2.giveIdol(idolOfTee);
			overlord3.giveIdol(idolOfEff);
		}
	} else if (anwerOfLord1Question1.getPronunciation() != anwerOfLord2Question2.getPronunciation()){ //If the first and second answers are not the same
		
			overlord1.giveIdol(idolOfArr);
			overlord2.giveIdol(idolOfEff);
			overlord3.giveIdol(idolOfTee);
		

	}

}

/**
* This solution yields a 40% success rate.
*/
const runFortyPercentSolution = ({anwerOfLord1Question1, anwerOfLord2Question2, answerOfLord3Question3}, {overlord1, overlord2, overlord3}, {idolOfTee, idolOfEff, idolOfArr}) => {

	if (anwerOfLord1Question1.getPronunciation() == anwerOfLord2Question2.getPronunciation()){
		if (anwerOfLord2Question2.getPronunciation() == answerOfLord3Question3.getPronunciation()){
			overlord1.giveIdol(idolOfEff);
			overlord2.giveIdol(idolOfTee);
			overlord3.giveIdol(idolOfArr);
		} else { //If the second and third answers are not the same
			overlord1.giveIdol(idolOfArr);
			overlord2.giveIdol(idolOfTee);
			overlord3.giveIdol(idolOfEff);
		}
	} else {
		overlord1.giveIdol(idolOfTee);
		overlord2.giveIdol(idolOfEff);
		overlord3.giveIdol(idolOfArr);
	}
}

/**
* This solution yields a 33% success rate.
*/
const runOneThirdSolution = ({anwerOfLord1Question1, anwerOfLord2Question2}, {overlord1, overlord2, overlord3}, {idolOfTee, idolOfEff, idolOfArr}) => {

	if (anwerOfLord1Question1.getPronunciation() == anwerOfLord2Question2.getPronunciation()){
		overlord1.giveIdol(idolOfEff);
		overlord2.giveIdol(idolOfTee);
	} else {
		overlord1.giveIdol(idolOfTee);
		overlord2.giveIdol(idolOfEff);
	}
	overlord3.giveIdol(idolOfArr);
}

function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}



</script>

<body>

<h1>Three Alien Overlords</h1>
<h2>Introduction</h2>
<a>Source of this riddle is on</a> <a href="https://www.youtube.com/watch?v=LKvjIsyYng8">this youtube video</a><a>. I am writing this program to help me solve the riddle without looking at the solution.</a>
<p>I don't expect this to be easy and I don't expect to reach a solution with this program alone. The goal is to learn as much as possible of the puzzle with this program.</p>
<h2>Deductions</h2>
<p>Here are deductions that I have made this far</p>
<li>The odds of guessing the overlords correctly is 1/3 * 1/2 = 1/6 or about 16.7%. There are six different ways to present the idols to the overlords.</li>
<li>The correct solution will have a 100% success rate, regardless of the order that the overlords appear and what the meaning for the words ozo and ulu are.</li>

<li>If I asked the same overlord three questions, it would help me figure who that overlord is. Then I would have a 50% chance of guessing the other two. I doubt that asking the same overlord three questions is the right way to go.</li>
<li>The possible combinations of directing questions to overlords is as follows. The number refers to which overlord you're addressing the question to (1,1,2 means 'Ask the first overlord a question, then the first one again, then the second one'):</li>
<ol>
	1, 1, 2<br>
	1, 2, 2<br>
	1, 2, 1<br>
	1, 2, 3<br>
</ol>
<li>'Ask the first one in line a question, then ask the second, then ask the second one again' is fundamentally the same as 'Ask the first one in line a question, then ask the third, then ask the third one again'. This is because I don't know which overlord is which.</li>
<li>I cannot deduce anything after asking the first question, since I don't know if the answer is a yes or a no. The only correct choice is to ask the second Overlord in line a question. It also makes no sense to ask the same question from the second overlord since the first answer gave me no information. The second question must be different from the first.</li>
<li>Maybe I do not need to worry about which word stands for yes and no. Perhaps the solution can only be found by comparing whether the answers are the same or if they are different.</li>
<li>Some ideas for questions:</li>
	- Are those last two answers different?<br>
	- Are there more yes-answers than no-answers?<br>
	- Are there more ulu-answers than ozo-answers?<br>
	- Does the word ulu stand for 'true'?
	- Were the last two answers a yes?
	- Were the last two answers the same?
	- Were the last two answers a no?
	- Is that the overlord who answers randomly?
	- Is one of those two overlords the one who answers randomly?
	- Using the operators AND or OR in a question: "Is the sky blue or does the word 'ozo' stand for 'yes'?"
	<br>
<li>I must be careful not ask stupid questions. Example:
- If answers to the first questions are 'ozo' and 'ozo' and if I asked the third question 'Are the answers to the first two questions the same'` - I would be asking an obvious thing that I already know. This would be the equivalent of asking whether the sky is blue. Since there are only three questions to ask, I must make the most of every question that I get and get as much information as possible with each question.</li>
<li>Here are how many combinations of answers to the three questions I can get:
<ol>
	<li>ozo, ozo, ozo</li>
	<li>ozo, ozo, ulu</li>
	<li>ozo, ulu, ozo</li>
	<li>ozo, ulu, ulu</li>
	<li>ulu, ozo, ozo</li>
	<li>ulu, ozo, ulu</li>
	<li>ulu, ulu, ozo</li>
	<li>ulu, ulu, ulu</li>
</ol>
So this adds up to 8 (like a binary number of three bits). If I do not know which word stands for 'yes' and 'no', I only have half as much because receiving the answers "ozo, ozo, ulu" is the equivalent of receiving the answers "ulu, ulu, ozo".
<li>Here are all configurations that the overlords can appear in:</li>

<ol>
	<li>Tee, Eff, Arr</li>
	<li>Tee, Arr, Eff</li>
	<li>Eff, Tee, Arr</li>
	<li>Eff, Arr, Tee</li>
	<li>Arr, Tee, Eff</li>
	<li>Arr, Eff, Tee</li>
</ol>
<li>Since there are 8 combinations of receiving answers to the three questions and only six combinations for the order that the overlords could appear in, <b>this riddle is probably not impossible to solve.</b> It might be possible to find questions that can receive answers that can be mapped to a specific order of the overlords.</li>
<li>If I do not know which word stands for 'yes' and 'no', I have only four combinations of answers. Therefore, it is imperative that I must find the meanings of the word "ulu" and "ozo" with my questions.</li>
<li>My code addresses the third question to <b>each</b> overlord. This is not cheating if my code only uses one of the three answers to deduce which overlord to give which idol. This is a feature used in-development to speed up information gathering.</li>
<li>I need to create a program that can analyze the logs of my solution programs. I must create a program that can analyze which answers map to which configuration of overlords, for example: "ozo, ozo, ulu" => Tee, Eff, Arr. If my program finds that one string of answers map to more than one configuration of overlords, then my questions are faulty and I need to improve them.</li>
<li>It turns out that console.log in a web browser is quite slow. Do not call it too many times successively.</li>
<br><br>
<button id="run-button">Run</button>
<button id="run-many-times-button">Run many times</button>
<br>
<p id="note-text"></p>
<br>
<p id="solution-log"></p>
<br>
<br>
<p id="analysis"></p>

</body>
